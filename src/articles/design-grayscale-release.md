---
title: 灰度发布的设计
---

# 纬度控制

1. 用户维度

2. 设备/客户端版本维度

   

3. 时间维度

   逐步放量时间

   当天的指定时间

4. 地理纬度

   ip



# 监控与回滚

系统指标：CPU使用率、内存使用率、数据库连接数

性能指标：吞吐量、错误率、95分位延迟

业务指标：转化率



自动回滚策略：错误率超过5%、延迟超过1秒、转化率下降10%



A/B 测试对比

数据一致性保障





# URI 版本控制

在 URI 中添加版本号作为一部分，以便在更改 API 时仍然可以访问旧版本。

例如，原始 URI 可能是 /api/user，但当添加版本号时，URI 可能变为 /api/v1/user。在这种情况下，如果 API 发生变化，开发人员可以通过更改版本号来升级应用程序，而不会影响到原始版本。

/api/v1/user

/api/user

# 请求头版本控制

请求头版本控制是另一种常见的 RESTful API 版本控制方法。开发人员可以在 HTTP 请求头中包含版本号，以便在服务器端对其进行处理。

例如，客户端可以使用请求头中的 Accept-Version 属性来指定所需的 API 版本。服务器可以根据 Accept-Version 属性确定要使用哪个版本的 API 进行响应。

# 查询参数版本控制

查询参数版本控制是一种将版本号作为查询参数的 RESTful API 版本控制方法。在 API 的 URI 中不添加版本号，而是在查询参数中包含版本号。

例如，/api/user?version=1 可以表示 v1 版本的 API，/api/user?version=2 可以表示 v2 版本的 API。当 API 发生变化时，只需更改查询参数中的版本号即可。
